<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Saju-Eight</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #0d1b2a;
      color: white;
      margin: 0;
      padding: 0;
    }
    .fortune-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin: 20px 0;
    }
    .fortune-card {
      background: #1b263b;
      border-radius: 10px;
      padding: 14px;
      position: relative;
      transition: all 0.3s ease;
    }
    .fortune-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .fortune-icon {
      font-size: 1.6rem; /* ‚úÖ ÏïÑÏù¥ÏΩò 2Î∞∞ ÌÅ¨Í≤å */
    }
    .see-btn {
      background: #3a86ff;
      border: none;
      color: white;
      font-weight: bold;
      border-radius: 6px;
      padding: 6px 10px;
      cursor: pointer;
    }
    .see-btn:hover {
      background: #2563eb;
    }
    .topic-content {
      margin-top: 12px;
      padding: 12px;
      background: #14213d;
      border-radius: 8px;
    }
    .tc-block {
      margin-bottom: 10px;
    }
    .tc-title {
      font-weight: bold;
      margin-bottom: 4px;
      color: #a9d6ff;
    }
    .topic-close {
      display: inline-block;
      margin-top: 14px;   /* ‚úÖ ÏúÑÏ™Ω Ïó¨Î∞± */
      align-self: flex-end;
      font-weight: 800;
      padding: 8px 10px;
      border-radius: 10px;
      background: #22314c;
      color: #cfe2ff;
      border: 1px solid #2c4168;
      cursor: pointer;
    }
    .chat-box {
      background: #1b263b;
      border-radius: 10px;
      padding: 12px;
      height: 300px;
      overflow-y: auto;
      margin: 20px 0;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .chat-msg {
      padding: 10px;
      border-radius: 8px;
      max-width: 75%;
      line-height: 1.4;
    }
    .chat-user {
      background: #3a86ff;
      align-self: flex-end;
    }
    .chat-bot {
      background: #14213d;
      border: 1px solid #2c4168;
      align-self: flex-start;
    }
    .chat-input-area {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 8px;
    }
    .chat-input {
      flex: 1;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #2c4168;
      background: #14213d;
      color: white;
    }
    .chat-send {
      background: #3a86ff;
      border: none;
      border-radius: 6px;
      padding: 8px 14px;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2 style="padding:20px;">Explore Specific Fortunes</h2>
  <div class="fortune-grid">
    <!-- Example Card -->
    <div class="fortune-card" data-topic="wealth">
      <div class="fortune-card-header">
        <span class="fortune-icon">üí∞</span>
        <button class="see-btn">See insights</button>
      </div>
      <div class="topic-content" style="display:none;"></div>
    </div>
    <div class="fortune-card" data-topic="love">
      <div class="fortune-card-header">
        <span class="fortune-icon">‚ù§Ô∏è</span>
        <button class="see-btn">See insights</button>
      </div>
      <div class="topic-content" style="display:none;"></div>
    </div>
    <!-- ÎÇòÎ®∏ÏßÄ 6Í∞ú Ïπ¥ÎìúÎèÑ Í∞ôÏùÄ Íµ¨Ï°∞Î°ú Ï∂îÍ∞Ä -->
  </div>

  <h2 style="padding:20px;">Ask About Your Saju</h2>
  <div class="chat-box" id="chatBox"></div>
  <div class="chat-input-area">
    <input id="chatInput" class="chat-input" placeholder="Type your question..."/>
    <button id="chatSend" class="chat-send">Ask</button>
  </div>

  <script>
    document.querySelectorAll(".see-btn").forEach(btn=>{
      btn.addEventListener("click", async ()=>{
        const card = btn.closest(".fortune-card");
        const topic = card.dataset.topic;
        const content = card.querySelector(".topic-content");

        // API Ìò∏Ï∂ú (ÏòàÏãú)
        let res = await fetch(`/api/ask?topic=${topic}`);
        let data = await res.json();

        if(data.ok){
          const {overview, phases, watch, tips} = data.output;
          content.innerHTML = `
            <div class="tc-block"><div class="tc-title">Overview</div>${overview||'No details yet.'}</div>
            <div class="tc-block"><div class="tc-title">Key Phases</div>${phases||''}</div>
            <div class="tc-block"><div class="tc-title">Watch Out</div>${watch||''}</div>
            <div class="tc-block"><div class="tc-title">Tips</div>${tips||''}</div>
            <div style="text-align:right"><button class="topic-close">Close</button></div>
          `;
          content.style.display="block";
          btn.style.display="none"; // ÌéºÏ≥êÏ°åÏùÑ Îïê Î≤ÑÌäº Ïà®ÍπÄ
          content.querySelector(".topic-close").addEventListener("click", ()=>{
            content.style.display="none";
            btn.style.display="inline-block"; // Îã´ÏúºÎ©¥ Îã§Ïãú Î≥¥ÏûÑ
          });
        }
      });
    });

    // --- Chat Í∏∞Îä• ---
    const chatBox=document.getElementById("chatBox");
    const chatInput=document.getElementById("chatInput");
    const chatSend=document.getElementById("chatSend");

    function addMsg(text,type){
      const div=document.createElement("div");
      div.className="chat-msg "+(type==="user"?"chat-user":"chat-bot");
      div.innerText=text;
      chatBox.appendChild(div);
      chatBox.scrollTop=chatBox.scrollHeight;
    }

    chatSend.addEventListener("click", async ()=>{
      const q=chatInput.value.trim();
      if(!q) return;
      addMsg(q,"user");
      chatInput.value="";
      try {
        let res=await fetch("/api/ask",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({q})});
        let data=await res.json();
        if(data.ok){
          addMsg(data.output,"bot");
        } else {
          addMsg("Sorry, I couldn't understand that. Could you rephrase? üôÇ","bot");
        }
      } catch(e){
        addMsg("‚ö†Ô∏è Network error, please try again.","bot");
      }
    });
  </script>
</body>
</html>
